<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="code-Type" code="text/html; charset=utf-8" />
    <meta name="viewport" code="width=device-width, initial-scale=1.0">
    <script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
    <script src="http://knockoutjs.com/downloads/knockout-2.2.1.js"></script>
    <script src="js/prettify.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <link href="css/prettify.css" rel="stylesheet" />
    <link href="css/bootstrap.min.css" rel="stylesheet" />
    <link href="css/bootstrap-responsive.min.css" rel="stylesheet" />

    <script src="Scripts/hammer.js"></script>
    <script src="Scripts/knockouch.js"></script>

    <!-- "Костыль" нужный для того, чтобы заставить IE6-8 понимать элементы HTML5: -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title></title>
</head>
<body>
    <div class="container-fluid">
        <div class="row-fluid">
            <div class="span2">
                <ul class="nav nav-list" data-bind="foreach: abilities">
                    <li>
                        <a data-bind="text: name, tap: $data.abilitieSelect">Home</a>
                    </li>
                </ul>
            </div>
            <div class="span10">
                <ul class="nav nav-tabs" data-bind="foreach: files">
                    <li class="active">
                        <a data-bind="text: name, tap: $parent.fileSelect"></a>
                    </li>
                </ul>
                <pre class="prettyprint linenums" data-bind="drag: $data.select, tap: $data.select, html: $data.code"></pre>
                <textarea id="codeViewer" data-bind="value: $data.code" class="input-block-level" rows="10"></textarea>
                <textarea ondblclick="prettyPrint()"></textarea>
            </div>

        </div>
    </div>
</body>
</html>
<script>


    function ability(name, color) {
        this.name = name;
        this.dependence = null;
        this.color = color;
    }

    function documentationViewModel(name) {
        var self = this;

        self.name = name;
        self.showEditor = ko.observable("none");
        self.abilities = ko.observableArray();
        self.selectedAbilitie = ko.observable();
        self.files = ko.observableArray();
        self.code = ko.observable('var el = document.createElement("bootstrap");');

        self.showHideEditor = function (data) {
            if (self.showEditor() == "none") {
                self.showEditor('');
            }
            else {
                self.showEditor("none");
            }
        }

        self.fileSelect = function (data, event) {
            self.code(data.code());
        }
        self.abilitieSelect = function (data, event) {
            self.selectedAbilitie(data);
        }

        self.select = function (data, event) {
            if (event.gesture.target.localName == "li") {
                event.gesture.target.setAttribute("data-doc", "red");
                parsDoc();
            }
            if (event.gesture.target.parentNode.localName == "li") {
                event.gesture.target.parentNode.setAttribute("data-doc", "red");
                parsDoc();
            }
        }

    }

    function fileViewModel(name, code) {
        this.name = name;
        this.code = ko.observable(code || 'var el = document.createElement("bootstrap"); lolka');
    }

    //-------
    documentation = new documentationViewModel('test');
    var file = new fileViewModel('Index.html');
    file.code('var el = document.createElement("bootstrap"); eee');

    var ability2 = new ability("Main", "rgba(230, 0, 0, 0.1)");
    var ability = new ability("Auth", "rgba(0, 120, 201, 0.1)");

    documentation.abilities.push(ability);
    documentation.abilities.push(ability2);
    documentation.files.push(file);
    //-------

    ko.applyBindings(documentation);
</script>
<script>
    var APP_ATTRIBUTE = "data-doc";

    var parsDoc = function () {
        var elem = document.getElementById("codeViewer");
        if (elem.children.length > 0) {
            for (var i in elem.children) {
                var elem = elem.childrens[i];
                if (elem.getAttribute) {
                    var attrValue = elem.getAttribute(APP_ATTRIBUTE);
                    if (attrValue !== null) {
                        for (var t in documentation.abilities()) {
                            var ability = documentation.abilities[t];
                            if (attrValue == ability.name)
                                $(elem).css("background-color", ability.color);
                        }
                    }
                }
            }
        }
    }

    parsDoc();

    !function ($) {
        $(function () {
            var $window = $(window)
            // Запускаем code pretty:
            window.prettyPrint && prettyPrint()
        })
    }(window.jQuery)

</script>
